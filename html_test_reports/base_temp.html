<!DOCTYPE html>
<html>
<head>
    <title>{{ report_title }}</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
</head>
<body>
    <div class="container">
        <div class="row bg-dark mt-2 pt-2">
            <div class="card col-12 bg-dark text-light text-center">
                <div class="card-header">
                    <h3 class="card-title">{{ report_title }}</h3>
                    <h5 class="card-subtitle text-white-50 mb-2"><i class="fa fa-clock-o"></i> <strong>Start Time:</strong> {{ header_info.start_time.strftime("%Y-%m-%d %H:%M:%S") }}</h5>
                    <h5 class="card-subtitle text-white-50 mt-2"><i class="fa fa-hourglass-half"></i> <strong>Duration:</strong> {{ header_info.status.duration }}</h5>
                </div>
                <div class="card-body">
                    <h4>
                      <ul class="list-inline">
                          <li class="list-inline-item"><span class="badge badge-light"><strong>Total</strong> <span class="badge badge-pill badge-dark">{{ header_info.status.total }}</span></span></li>
                          <li class="list-inline-item"><span class="badge badge-success"><i class="fa fa-thumbs-o-up"></i> <strong>Pass</strong> <span class="badge badge-pill badge-dark">{{ header_info.status.success }}</span></span></li>
                          <li class="list-inline-item"><span class="badge badge-warning"><i class="fa fa-thumbs-o-down"></i> <strong>Fail</strong> <span class="badge badge-pill badge-dark">{{ header_info.status.failure }}</span></span></li>
                          <li class="list-inline-item"><span class="badge badge-danger"><i class="fa fa-times-circle"></i> <strong>Error</strong> <span class="badge badge-pill badge-dark">{{ header_info.status.error }}</span></span></li>
                          <li class="list-inline-item"><span class="badge badge-info"><i class="fa fa-cut"></i> <strong>Skip</strong> <span class="badge badge-pill badge-dark">{{ header_info.status.skip }}</span></span></li>
                      </ul>
                    </h4>
                </div>
            </div>
        </div>
        <div class="row bg-secondary pt-2 pb-2">
        {% for test_case_name, tests_results in all_results.items() %}
        {% if tests_results %}
        <div class="col-12 col-md-10 card bg-light mx-auto m-2">
            <div class="card-header">
                <h5 class="card-title">{{ test_case_name.split('.')[-1] }}</h5>
                <h6 class="card-subtitle text-black-50 mt-2"><i class="fa fa-file-code-o"></i> {{ '/'.join(test_case_name.split('.')[:-1]) + '.py' }}</h6>
            </div>
            <div class="card-body table-responsive pt-0 pb-0">
                <table class='table table-sm table-dark table-hover mb-0'>
                    <thead>
                        <tr>
                            <th class="pl-2"><i class="fa fa-flask"></i> Tests</th>
                            <th><i class="fa fa-clipboard"></i> Status</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for test_case in tests_results %}
                    {% if not test_case.subtests is defined %}
                    <tr>
                        <td class="pl-2">{{ test_case.test_id.split(".")[-1] }}</td>
                        <td>
                            {%- if test_case.outcome == test_case.SUCCESS -%}
                            Pass
                            {%- elif test_case.outcome == test_case.SKIP -%}
                            Skip
                            {%- elif test_case.outcome == test_case.FAILURE -%}
                            Fail
                            {%- else -%}
                            Error
                            {%- endif -%}
                        </td>
                        <td>
                        {%- if (test_case.stdout or test_case.err) %}
                        <button class="btn btn-default btn-xs">View</button>
                        {%- endif %}
                        </td>
                    </tr>
                    {%- if (test_case.stdout or test_case.err or test_case.err) and test_case.outcome != test_case.SKIP %}
                    <tr style="display:none;">
                        <td class="col-9" colspan="3">
                        {%- if test_case.stdout %}<p>{{ test_case.stdout }}</p>{% endif %}
                        {%- if test_case.err %}<p style="color:maroon;">{{ test_case.err[0].__name__ }}: {{ test_case.err[1] }}</p>{% endif %}
                        {%- if test_case.err %}<p style="color:maroon;">{{ test_case.test_exception_info }}</p>{% endif %}
                        </td>
                    </tr>
                    {%- endif %}
                    {%- if (test_case.stdout or test_case.err or test_case.err) and test_case.outcome == test_case.SKIP %}
                    <tr style="display:none;">
                        <td class="col-9" colspan="3">
                        {%- if test_case.stdout %}<p>{{ test_case.stdout }}</p>{% endif %}
                        {%- if test_case.err %}<p style="color:maroon;">{{ test_case.err }}</p>{% endif %}
                        </td>
                    </tr>
                    {%- endif %}
                    {%- else %}
                    <tr class='{{ status_tags[test_case.outcome] }}'>
                        <td class="col-10">{{ test_case.test_id.split(".")[-1] }}</td>
                        <td class="col-1">
                            <span class="label label-{{ status_tags[test_case.outcome] }}" style="display:block;width:40px;">
                            {%- if test_case.outcome == test_case.SUCCESS -%}
                            Pass
                            {%- else -%}
                            Fail
                            {%- endif -%}
                            </span>
                        </td>
                        <td class="col-1">
                        {%- if test_case.subtests %}
                        <button class="btn btn-default btn-xs">View</button>
                        {%- endif %}
                        </td>
                    </tr>
                    {%- if test_case.subtests %}
                    <tr style="display:none;">
                        <td colspan="3">
                            <table class='table table-hover table-responsive'>
                                <tbody>
                                {%- for subtest in test_case.subtests %}
                                <tr class='{{ status_tags[subtest.outcome] }}'>
                                    <td class="col-10">{{ subtest.test_id.split(".")[-1] }}</td>
                                    <td class="col-1">
                                        <span class="label label-{{ status_tags[subtest.outcome] }}" style="display:block;width:40px;">
                                        {%- if subtest.outcome == subtest.SUCCESS -%}
                                        Pass
                                        {%- else -%}
                                        Fail
                                        {%- endif -%}
                                        </span>
                                    </td>
                                    <td class="col-1">
                                    {%- if subtest.err %}
                                    <button class="btn btn-default btn-xs">View</button>
                                    {%- endif %}
                                    </td>
                                </tr>
                                {%- if subtest.err or subtest.err %}
                                <tr style="display:none;">
                                    <td class="col-9" colspan="3">
                                    {%- if subtest.err %}<p style="color:maroon;">{{ subtest.err[0].__name__ }}: {{ subtest.err[1] }}</p>{% endif %}
                                    {%- if subtest.err %}<p style="color:maroon;">{{ subtest.test_exception_info }}</p>{% endif %}
                                    </td>
                                </tr>
                                {%- endif %}
                                {% endfor %}
                                </tbody>
                            </table>
                        </td>
                    </tr>
                    {%- endif %}
                    {%- endif %}
                    {%- endfor %}
                    </tbody>
                    <caption class="pb-0">
                      <h5 class="mb-0">
                        <ul class="list-inline">
                            <li class="list-inline-item"><span class="badge badge-dark"><strong>Total</strong> <span class="badge badge-pill badge-light">{{ summaries[test_case_name].total }}</span></span></li>
                            <li class="list-inline-item"><span class="badge badge-success"><i class="fa fa-thumbs-o-up"></i> <strong>Pass</strong> <span class="badge badge-pill badge-dark">{{ summaries[test_case_name].success }}</span></span></li>
                            <li class="list-inline-item"><span class="badge badge-warning"><i class="fa fa-thumbs-o-down"></i> <strong>Fail</strong> <span class="badge badge-pill badge-dark">{{ summaries[test_case_name].failure }}</span></span></li>
                            <li class="list-inline-item"><span class="badge badge-danger"><i class="fa fa-times-circle"></i> <strong>Error</strong> <span class="badge badge-pill badge-dark">{{ summaries[test_case_name].error }}</span></span></li>
                            <li class="list-inline-item"><span class="badge badge-info"><i class="fa fa-cut"></i> <strong>Skip</strong> <span class="badge badge-pill badge-dark">{{ summaries[test_case_name].skip }}</span></span></li>
                        </ul>
                      </h5>
                    </caption>
                </table>
            </div>
        </div>
        {%- endif %}
        {%- endfor %}
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js" integrity="sha384-6khuMg9gaYr5AxOqhkVIODVIvm9ynTT5J4V1cfthmT+emCG6yVmEZsRHdxlotUnm" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $('td').on('click', '.btn', function(e){
                e.preventDefault();
                e.stopImmediatePropagation();
                var $this = $(this);
                var $nextRow = $this.closest('tr').next('tr');
                $nextRow.slideToggle("fast");
                $this.text(function(i, text){
                    if (text === 'View') {
                        return 'Hide';
                    } else {
                        return 'View';
                    };
                });
            });
        });
    </script>
</body>
</html>
